# Following testing rule works
# - alias: 'Random sensor trigger twitter'
#   trigger:
#     platform: state
#     entity_id: binary_sensor.random_change
#     to: "on"
#   action:
#     service: notify.twitter_wang3an
#     data:
#       message:
#     data_template:
#       message: >
#         Auto tweet : Random value {{ states.sensor.random_1.state }} is less than 50.  

- alias: 'Daily modem power off at 5:50'
  trigger:
    platform: time
    at: '05:50:00'
  action:
    service: switch.turn_off
    entity_id: switch.modem_xiaomi_mi_wifi_socket_basic
- alias: 'Daily modem power on at 5:53'
  trigger:
    platform: time
    at: '05:53:00'
  action:
    service: switch.turn_on
    entity_id: switch.modem_xiaomi_mi_wifi_socket_basic

# - alias: 'Daily orvibo power on at 6:00'
#   trigger:
#     platform: time
#     at: '06:00:00'
#   action:
#     service: switch.turn_on
#     entity_id: switch.orange_orvibo_wifi_socket
# - alias: 'Daily orvibo power off at 7:00'
#   trigger:
#     platform: time
#     at: '07:00:00'
#   action:
#     service: switch.turn_off
#     entity_id: switch.orange_orvibo_wifi_socket

- alias: 'TTS on finished cleaning'
  trigger:
    platform: state
    entity_id: vacuum.cleaner_xiaomi_clean_robot
    from: 'on'
    to: 'off'
  action:
    service: tts.google_say
    entity_id: media_player.living_room_home
    data:
      # message: !include tts-cleaner-robot-job-done.yaml # this mode won't work
      message: "My lord, your cleaner robot had just finished cleaning."

- alias: 'TV power on when Chromecast playing'
  trigger:
    - platform: state
      entity_id: media_player.living_room_tv
      from: 'off'
      to: 'idle'
    - platform: state
      entity_id: media_player.living_room_tv
      from: 'off'
      to: 'playing'
  condition:
    condition: state
    entity_id: binary_sensor.skyworth_tv
    state: 'off' # not detected
  action:
    - service: media_player.media_pause # waiting for tv power on
      entity_id: media_player.living_room_tv
    - service: switch.turn_on
      entity_id: switch.skyworth_tv_power
    - delay: '00:00:30' # left some seconds for tv power on
    - service: media_player.media_play # continue playing
      entity_id: media_player.living_room_tv

################################################################
# begin : automation for "stop working, take a walk"
- alias: "TTS on event (speak and start timer): stop working, take a walk"
  trigger:
    platform: state
    entity_id: calendar.start_work
    from: 'on'
    to: 'off' # stop working
  action:
    - service: tts.google_say
      entity_id: media_player.living_room_home
      data:
        message: "Time to take a walk, human!"
    - service: switch.turn_on # set the signal on
      entity_id: switch.orange_orvibo_wifi_socket
    - service: timer.start # start the timer for repeat
      entity_id: timer.timer_for_repeat_tts_take_a_walk

- alias: "TTS on timer (speak and start timer again): stop working, take a walk"
  trigger:
    platform: state
    entity_id: timer.timer_for_repeat_tts_take_a_walk
    to: 'idle' # time up
  condition:
    condition: state
    entity_id: switch.orange_orvibo_wifi_socket
    state: 'on' # repeat if signal is on
  action:
    - service: tts.google_say
      entity_id: media_player.living_room_home
      data:
        # message: "Time to take a walk, human!"
        message: "喂！够了够了，必须站起来走走了！"
        language: "zh"
    - service: timer.start # start this timer again
      entity_id: timer.timer_for_repeat_tts_take_a_walk
# end : automation for "stop working, take a walk"
################################################################
